# Qwen ASR API 测试工具使用说明

## 功能

这是一个独立的命令行工具，用于测试 Qwen ASR API 是否能正常工作。

## 使用步骤

### 1. 准备测试音频文件

需要一个 WAV 格式的音频文件。可以：
- 使用现有的录音文件
- 用 Windows 录音机录制一段测试音频
- 从临时目录找之前录制的文件：`C:\Users\你的用户名\AppData\Local\Temp\recording_*.wav`

### 2. 运行测试工具

在 `src-tauri` 目录下运行：

```bash
cd src-tauri
cargo run --bin test_api
```

### 3. 按提示输入信息

工具会要求你输入：
1. **DashScope API Key** (或设置环境变量 `DASHSCOPE_API_KEY`)
2. **音频文件的完整路径**

### 4. 查看结果

工具会显示：
- ✓ 文件读取成功
- ✓ Base64 编码成功
- ✓ API 请求成功
- ✓ 响应状态
- 📝 完整的 API 响应
- ✅ 转录结果

## 示例输出

```
=== Qwen ASR API 测试工具 ===

✓ API Key: sk-1234567...

请输入音频文件路径 (WAV 格式):
C:\Users\10455\AppData\Local\Temp\recording_1761756735.wav

✓ 音频文件: C:\Users\10455\AppData\Local\Temp\recording_1761756735.wav

正在读取音频文件...
✓ 文件大小: 256000 bytes

正在编码为 base64...
✓ Base64 长度: 341332 字符

正在构建 API 请求...
✓ 请求体已构建

正在发送请求到: https://dashscope.aliyuncs.com/...
✓ 响应状态: 200 OK

=== 完整 API 响应 ===
{
  "output": {
    "choices": [
      {
        "message": {
          "content": [
            {
              "text": "你好，这是一段测试音频"
            }
          ]
        }
      }
    ]
  },
  ...
}

=== 提取转录结果 ===
✅ 转录成功！

📝 转录结果:
─────────────────────────────────
你好，这是一段测试音频
─────────────────────────────────
```

## 环境变量方式（可选）

可以设置环境变量避免每次输入 API Key：

**Windows (PowerShell):**
```powershell
$env:DASHSCOPE_API_KEY="sk-你的API密钥"
cargo run --bin test_api
```

**Windows (CMD):**
```cmd
set DASHSCOPE_API_KEY=sk-你的API密钥
cargo run --bin test_api
```

## 故障排查

### 问题 1: 找不到音频文件
- 确保路径正确，使用完整的绝对路径
- Windows 路径示例: `C:\Users\YourName\test.wav`
- 使用正斜杠 `/` 或双反斜杠 `\\`

### 问题 2: API 返回错误
- 检查 API Key 是否正确
- 查看完整的错误响应
- 确认账号有足够的额度

### 问题 3: 转录结果为空
- 确认音频文件包含语音内容
- 检查音频格式是否为 WAV
- 查看完整的 API 响应判断问题

## 测试成功后

如果测试工具能正常转录，说明：
✅ API Key 正确
✅ 网络连接正常
✅ API 调用代码正确
✅ 响应解析逻辑正确

那么主应用的问题可能在：
- 音频录制质量
- 文本插入逻辑
- 事件通信

## 快速测试命令

创建一个简单的测试脚本（Windows PowerShell）：

```powershell
# test.ps1
$env:DASHSCOPE_API_KEY="sk-你的API密钥"
cd src-tauri
cargo run --bin test_api
```

然后运行：
```powershell
.\test.ps1
```
