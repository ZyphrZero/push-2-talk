# PushToTalk - 按键语音转文字应用需求文档

## 1. 项目概述

### 1.1 项目背景
基于现有的 Python 版本 PushToTalk 应用（[原项目地址](G:\project\push-to-talk-main)），使用 Rust + React + Tauri 技术栈重新实现，开发一个高性能、跨平台的桌面应用，主要目标平台为 Windows，可打包为独立的 exe 可执行文件。

**与原项目的主要区别**：
- 不实现本地模型（去除 FunASR SenseVoice）
- **仅使用云端 API**（OpenAI Whisper、Alibaba Qwen）
- 使用 Rust 替代 Python 以获得更好的性能和更小的打包体积
- 使用 React 替代 Tkinter 获得更现代的 UI 体验

### 1.2 核心功能
- **按住说话（Push-to-Talk）**：按住快捷键期间录音，释放停止
- **切换录音模式（Toggle）**：按一次开始录音，再按一次停止
- **云端语音识别**：支持 OpenAI Whisper 和 Alibaba Qwen API
- **智能音频处理**：自动静音移除和音高保持的加速处理
- **AI 文本优化**：使用 GPT 模型优化转录文本
- **流式文本输出**：逐字符实时插入文本
- **自动文本插入**：自动将文本插入到活动窗口
- **自定义术语表**：提高领域特定词汇的识别准确性
- **音频反馈**：录音开始/停止的音频提示

## 2. 功能需求

### 2.1 核心功能需求

#### 2.1.1 全局快捷键监听
- **FR-001**: 全局快捷键检测，应用在后台也能响应
- **FR-002**: 支持两种录音模式：
  - **按住说话模式**：按住快捷键录音，释放停止（默认：Ctrl+Shift+Space）
  - **切换录音模式**：按一次开始，再按一次停止（默认：Ctrl+Shift+^）
- **FR-003**: 支持自定义快捷键配置（单键或组合键）
- **FR-004**: 防止重复快捷键分配
- **FR-005**: 快捷键冲突检测和提示

#### 2.1.2 音频录制
- **FR-006**: 使用系统默认麦克风进行音频采集
- **FR-007**: 支持选择不同的音频输入设备
- **FR-008**: 可配置音频参数：
  - 采样率：8kHz / 16kHz（推荐）/ 44.1kHz
  - 声道：单声道（推荐）/ 立体声
  - 块大小：512 / 1024（推荐）/ 2048
- **FR-009**: 音频格式：WAV (PCM)
- **FR-010**: 录音音频反馈：
  - 开始录音：高音提示音（880 Hz）
  - 停止录音：低音确认音（660 Hz）
  - 可选开启/关闭

#### 2.1.3 音频处理
- **FR-011**: 智能静音移除：
  - 可配置静音阈值（dBFS，推荐 -16.0）
  - 可配置最小静音持续时间（ms，推荐 400ms）
- **FR-012**: 音高保持的加速处理：
  - 可配置加速因子（推荐 1.5x）
  - 使用 PSOLA 算法保持音高不变
- **FR-013**: 立体声转单声道（如需要）
- **FR-014**: 调试模式：保存处理后的音频文件用于调试

#### 2.1.4 语音转文字（仅云端 API）
- **FR-015**: 支持 OpenAI Whisper API
- **FR-016**: 支持 Alibaba Qwen API（qwen3-asr-flash）
- **FR-017**: 可配置 API 密钥
- **FR-018**: API 密钥验证功能
- **FR-019**: 支持流式输出（逐字符插入）
- **FR-020**: 可配置语言（中文、英文、自动检测）
- **FR-021**: 网络错误处理和重试机制

#### 2.1.5 AI 文本优化
- **FR-022**: 使用 GPT 模型优化转录文本（可选）
- **FR-023**: 支持自定义优化提示词
- **FR-024**: 集成自定义术语表：
  - 通过 GUI 添加/编辑/删除术语
  - 术语自动包含在优化提示中
  - 支持搜索已有术语
- **FR-025**: 可禁用文本优化以加快处理速度
- **FR-026**: 去除填充词（嗯、啊等）和口吃

#### 2.1.6 文本输入与输出
- **FR-027**: 自动将文本插入到活动窗口
- **FR-028**: 支持两种插入方法：
  - **Clipboard 方法**：速度快，使用剪贴板+Ctrl+V
  - **SendKeys 方法**：兼容性好，适合特殊字符
- **FR-029**: 可配置插入延迟（默认 0.005 秒）
- **FR-030**: 流式文本插入（逐字符显示，可选）
- **FR-031**: 在应用界面显示转录结果
- **FR-032**: 手动复制文本到剪贴板
- **FR-033**: 历史记录功能（保存最近的转录结果）

### 2.2 用户界面需求

#### 2.2.1 主界面
- **UI-001**: 现代化的 React UI 设计
- **UI-002**: 实时状态指示器：
  - 灰色圆圈 + "准备启动"：应用已停止
  - 绿色圆圈 + "运行中"：应用正在运行
  - 红色圆圈 + "录音中"：正在录制音频
  - 黄色圆圈 + "处理中"：正在转录和优化
- **UI-003**: 欢迎区域：简要说明应用功能
- **UI-004**: 活动设置显示：运行时显示当前快捷键和启用的功能
- **UI-005**: 转录结果显示区域
- **UI-006**: 启动/停止应用按钮（持久化控制）

#### 2.2.2 设置面板
- **UI-007**: API 设置：
  - OpenAI API 密钥输入（带显示/隐藏功能）
  - STT 模型选择（OpenAI Whisper / Alibaba Qwen）
  - 文本优化模型选择
  - API 密钥测试按钮
- **UI-008**: 音频设置：
  - 音频设备选择下拉框
  - 采样率选择（8kHz / 16kHz / 44.1kHz）
  - 声道选择（单声道/立体声）
  - 块大小配置
  - 音频处理开关（静音移除、加速）
  - 音频反馈开关
- **UI-009**: 快捷键配置：
  - 按住说话快捷键设置
  - 切换录音快捷键设置
  - 快捷键验证和冲突检测
  - 常见快捷键示例
- **UI-010**: 文本插入设置：
  - 插入方法选择（Clipboard / SendKeys）
  - 插入延迟配置
  - 流式输出开关
  - 去除标点符号开关
- **UI-011**: 自定义术语表管理：
  - 术语列表显示
  - 添加/编辑/删除术语
  - 搜索术语功能
- **UI-012**: 其他设置：
  - 主题切换（亮色/暗色）
  - 启用日志记录
  - 调试模式开关
  - 开机自启动

#### 2.2.3 历史记录
- **UI-013**: 显示最近的转录记录
- **UI-014**: 每条记录显示：时间戳、原始文本、优化后文本
- **UI-015**: 支持复制历史记录到剪贴板
- **UI-016**: 清除历史记录功能

### 2.3 非功能需求

#### 2.3.1 性能需求
- **NFR-001**: 按键响应延迟 < 50ms
- **NFR-002**: 音频处理时间 < 1秒（3-4秒音频）
- **NFR-003**: 云端 API 转录时间取决于网络，通常 2-5秒
- **NFR-004**: 应用启动时间 < 2秒
- **NFR-005**: 内存占用 < 100MB（待机状态）
- **NFR-006**: 打包后的 exe 大小 < 30MB

#### 2.3.2 可靠性需求
- **NFR-007**: 应用能够长时间运行不崩溃（24小时+）
- **NFR-008**: 音频录制失败时优雅降级，显示错误提示
- **NFR-009**: 网络 API 调用失败时有重试机制
- **NFR-010**: 配置文件损坏时使用默认配置

#### 2.3.3 可用性需求
- **NFR-011**: 首次启动时显示快速入门指南
- **NFR-012**: 所有错误都有清晰的错误信息和解决建议
- **NFR-013**: 支持中英文界面（优先中文）
- **NFR-014**: 配置更改立即生效或明确提示重启

#### 2.3.4 安全需求
- **NFR-015**: API 密钥加密存储
- **NFR-016**: 日志文件不包含敏感信息
- **NFR-017**: 临时音频文件处理后自动删除

#### 2.3.5 兼容性需求
- **NFR-018**: 支持 Windows 10 及以上版本
- **NFR-019**: 适配不同屏幕分辨率和 DPI 缩放
- **NFR-020**: 预留 macOS 和 Linux 扩展接口

## 3. 技术栈

### 3.1 前端技术
- **框架**: React 18+ with TypeScript
- **构建工具**: Vite（Tauri 推荐）
- **UI 框架**:
  - Tailwind CSS（样式）
  - shadcn/ui 或 Ant Design（组件库）
  - Lucide React（图标）
- **状态管理**: Zustand 或 Jotai（轻量级状态管理）
- **表单验证**: Zod + React Hook Form
- **类型检查**: TypeScript 5+

### 3.2 后端技术（Rust + Tauri）
- **核心框架**: Tauri 2.x
- **音频处理**:
  - `cpal` v0.15+（跨平台音频 I/O）
  - `hound` v3.5+（WAV 文件读写）
  - `rubato` v0.14+（音频重采样）
- **音频高级处理**:
  - Rust 实现的 PSOLA 算法（音高保持的时间拉伸）
  - 或调用 Python 的 `pydub` + `psola`（通过进程间通信）
- **全局快捷键**:
  - `tauri-plugin-global-shortcut` v2.x
  - `rdev` v0.5+（底层键盘事件监听，用于按键释放检测）
- **HTTP 客户端**:
  - `reqwest` v0.11+（异步 HTTP 客户端）
  - 用于调用 OpenAI Whisper API 和 Alibaba Qwen API
- **JSON 处理**:
  - `serde` + `serde_json`（序列化/反序列化）
- **系统集成**:
  - `enigo` v0.1+（模拟键盘输入，实现 SendKeys）
  - `arboard` v3.3+（剪贴板操作）
  - `tauri-plugin-fs`（文件系统访问）
- **音频反馈**:
  - `rodio` v0.17+（音频播放库）
- **日志记录**:
  - `tracing` + `tracing-subscriber`（结构化日志）
  - `log` crate（日志接口）
- **异步运行时**:
  - `tokio` v1.x（异步运行时）
- **错误处理**:
  - `thiserror` v1.x（错误定义）
  - `anyhow` v1.x（错误传播）

### 3.3 API 集成
#### 3.3.1 OpenAI API
- **Whisper API**：语音转文字
  - 模型：`whisper-1`
  - 文件格式：WAV/MP3
  - 最大文件大小：25MB

#### 3.3.2 Alibaba DashScope API
- **Qwen ASR**：语音转文字
  - 模型：`qwen3-asr-flash`（推荐）
  - 支持流式输出
  - 支持中英文混合识别

#### 3.3.3 文本优化 API
- 使用 GPT-3.5/GPT-4 或 Qwen-Max 等模型
- 自定义提示词包含术语表

### 3.4 打包与部署
- **打包工具**: Tauri CLI
- **目标平台**: Windows 10/11 (x64)
- **安装方式**:
  - NSIS 安装包（.exe 安装程序）
  - 便携式版本（单个 exe，无需安装）
- **更新机制**: Tauri 内置更新器（可选）
- **图标**: 自定义应用图标（.ico）

## 4. 系统架构

### 4.1 整体架构图

```
┌─────────────────────────────────────────────────────┐
│                 React Frontend                      │
│  ┌───────────────────────────────────────────────┐ │
│  │  UI Components                                │ │
│  │  - StatusIndicator  - SettingsPanel           │ │
│  │  - TranscriptDisplay - HistoryPanel           │ │
│  │  - ControlButtons   - GlossaryManager         │ │
│  └───────────────────────────────────────────────┘ │
│  ┌───────────────────────────────────────────────┐ │
│  │  State Management (Zustand/Jotai)            │ │
│  │  - App State     - Settings State             │ │
│  │  - Recording State - History State            │ │
│  └───────────────────────────────────────────────┘ │
└────────────────────┬────────────────────────────────┘
                     │ Tauri IPC (Command/Event)
┌────────────────────▼────────────────────────────────┐
│              Rust Backend (Tauri Core)              │
│  ┌───────────────────────────────────────────────┐ │
│  │  1. Global Hotkey Service                     │ │
│  │     - Register push-to-talk hotkey            │ │
│  │     - Register toggle hotkey                  │ │
│  │     - Key press/release detection (rdev)      │ │
│  └─────────────┬─────────────────────────────────┘ │
│                │ Event: hotkey_pressed             │
│  ┌─────────────▼─────────────────────────────────┐ │
│  │  2. Audio Recording Module                    │ │
│  │     - Device enumeration (cpal)               │ │
│  │     - Audio stream capture                    │ │
│  │     - WAV file generation (hound)             │ │
│  └─────────────┬─────────────────────────────────┘ │
│                │ WAV file path                     │
│  ┌─────────────▼─────────────────────────────────┐ │
│  │  3. Audio Processing Module                   │ │
│  │     - Silence detection & removal             │ │
│  │     - Speed adjustment (PSOLA)                │ │
│  │     - Stereo to mono conversion               │ │
│  └─────────────┬─────────────────────────────────┘ │
│                │ Processed audio file              │
│  ┌─────────────▼─────────────────────────────────┐ │
│  │  4. Cloud STT Module (reqwest)                │ │
│  │     - OpenAI Whisper API client               │ │
│  │     - Alibaba Qwen API client                 │ │
│  │     - Streaming support                       │ │
│  └─────────────┬─────────────────────────────────┘ │
│                │ Raw transcription text            │
│  ┌─────────────▼─────────────────────────────────┐ │
│  │  5. Text Refinement Module                    │ │
│  │     - GPT/Qwen API integration                │ │
│  │     - Custom glossary injection               │ │
│  │     - Filler word removal                     │ │
│  └─────────────┬─────────────────────────────────┘ │
│                │ Refined text                      │
│  ┌─────────────▼─────────────────────────────────┐ │
│  │  6. Text Insertion Module                     │ │
│  │     - Clipboard method (arboard)              │ │
│  │     - SendKeys method (enigo)                 │ │
│  │     - Streaming character insertion           │ │
│  └─────────────┬─────────────────────────────────┘ │
│                │ Insertion complete                │
│  ┌─────────────▼─────────────────────────────────┐ │
│  │  7. Config & Storage Module                   │ │
│  │     - Settings persistence (JSON)             │ │
│  │     - History management                      │ │
│  │     - API key encryption                      │ │
│  └───────────────────────────────────────────────┘ │
│  ┌───────────────────────────────────────────────┐ │
│  │  8. Audio Feedback Module (rodio)             │ │
│  │     - Start beep (880 Hz)                     │ │
│  │     - Stop beep (660 Hz)                      │ │
│  └───────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────┘
                     │
          ┌──────────┴──────────┐
          ▼                     ▼
  ┌───────────────┐     ┌──────────────┐
  │  OpenAI API   │     │ Alibaba API  │
  │  (Whisper +   │     │ (Qwen ASR +  │
  │   GPT)        │     │  Qwen-Max)   │
  └───────────────┘     └──────────────┘
```

### 4.2 数据流（Push-to-Talk 模式）

```
1. 用户按下快捷键
         ↓
2. rdev 检测到按键按下事件
         ↓
3. 通知前端更新状态为"录音中"
         ↓
4. 播放开始音频反馈（880 Hz beep）
         ↓
5. 启动 cpal 音频流录制
         ↓
6. 音频数据持续写入缓冲区
         ↓
7. 用户释放快捷键
         ↓
8. rdev 检测到按键释放事件
         ↓
9. 播放停止音频反馈（660 Hz beep）
         ↓
10. 停止录制，保存为临时 WAV 文件
         ↓
11. 通知前端更新状态为"处理中"
         ↓
12. 音频处理（静音移除 + 加速）
         ↓
13. 上传处理后的音频到云端 API
         ↓
14. 接收转录文本（支持流式）
         ↓
15. 【可选】调用 GPT API 优化文本
         ↓
16. 使用 Clipboard/SendKeys 插入文本
         ↓
17. 通知前端显示结果
         ↓
18. 保存到历史记录
         ↓
19. 删除临时音频文件
         ↓
20. 恢复状态为"运行中"
```

### 4.3 线程模型

```
┌─────────────────┐
│   Main Thread   │  运行 Tauri 和前端渲染
└────────┬────────┘
         │
         ├─────┐
         │     │
    ┌────▼─────▼──────┐
    │  Tokio Runtime  │  异步任务调度
    └────┬────┬───┬───┘
         │    │   │
    ┌────▼┐  ┌▼───▼────┐  ┌────────────┐
    │Hotkey│  │Audio    │  │API Request │
    │Thread│  │Recording│  │Task Pool   │
    └──────┘  │Thread   │  └────────────┘
              └─────────┘
```

- **Main Thread**: 运行 Tauri 主循环和前端 UI
- **Hotkey Thread**: rdev 全局按键监听（独立线程）
- **Audio Recording Thread**: cpal 音频流录制（独立线程）
- **API Request Task Pool**: Tokio 异步任务池，处理 HTTP 请求

## 5. 核心模块设计

### 5.1 全局快捷键模块 (Hotkey Service)

**职责**:
- 注册和管理全局快捷键
- 检测按键按下和释放事件
- 支持两种模式：按住说话 (Push-to-Talk) 和切换录音 (Toggle)
- 触发录音开始/停止事件

**主要 API**:
```rust
pub struct HotkeyService {
    push_to_talk_key: String,
    toggle_key: String,
    is_recording: Arc<Mutex<bool>>,
}

impl HotkeyService {
    // 启动快捷键监听服务
    pub fn start(&mut self, on_start: impl Fn(), on_stop: impl Fn()) -> Result<()>;

    // 停止服务
    pub fn stop(&mut self) -> Result<()>;

    // 修改快捷键
    pub fn change_hotkey(&mut self, new_key: &str, mode: HotkeyMode) -> Result<()>;

    // 解析快捷键字符串（如 "ctrl+shift+space"）
    fn parse_hotkey(key_string: &str) -> Result<Vec<Key>>;
}

pub enum HotkeyMode {
    PushToTalk,  // 按住说话
    Toggle,      // 切换录音
}
```

### 5.2 音频录制模块 (Audio Recorder)

**职责**:
- 枚举系统音频输入设备
- 管理音频流的开启和停止
- 将音频数据写入 WAV 文件
- 支持可配置的音频参数

**主要 API**:
```rust
pub struct AudioRecorder {
    device: Option<cpal::Device>,
    sample_rate: u32,
    channels: u16,
    chunk_size: usize,
}

impl AudioRecorder {
    // 列出所有可用的音频输入设备
    pub fn list_devices() -> Result<Vec<AudioDevice>>;

    // 选择音频设备
    pub fn select_device(&mut self, device_name: &str) -> Result<()>;

    // 开始录音
    pub fn start_recording(&mut self) -> Result<()>;

    // 停止录音并返回 WAV 文件路径
    pub fn stop_recording(&mut self) -> Result<PathBuf>;

    // 获取当前录音状态
    pub fn is_recording(&self) -> bool;
}

#[derive(Serialize, Deserialize)]
pub struct AudioDevice {
    pub name: String,
    pub is_default: bool,
}
```

### 5.3 音频处理模块 (Audio Processor)

**职责**:
- 静音检测和移除
- 音高保持的时间拉伸（加速）
- 立体声转单声道
- 音频格式转换

**主要 API**:
```rust
pub struct AudioProcessor {
    silence_threshold: f32,      // dBFS
    min_silence_duration: f32,   // ms
    speed_factor: f32,           // 1.5 = 1.5x speed
}

impl AudioProcessor {
    pub fn new(threshold: f32, min_silence: f32, speed: f32) -> Self;

    // 处理音频文件（静音移除 + 加速）
    pub async fn process_audio(&self, input_path: &Path) -> Result<PathBuf>;

    // 检测并移除静音段
    fn remove_silence(&self, audio: AudioSegment) -> Result<AudioSegment>;

    // 音高保持的时间拉伸
    fn time_stretch(&self, audio: AudioSegment, factor: f32) -> Result<AudioSegment>;

    // 立体声转单声道
    fn stereo_to_mono(&self, audio: AudioSegment) -> Result<AudioSegment>;
}
```

### 5.4 云端 STT 模块 (Cloud STT Client)

**职责**:
- 与 OpenAI Whisper API 通信
- 与 Alibaba Qwen API 通信
- 支持流式输出
- 错误处理和重试机制

**主要 API**:
```rust
pub trait SpeechToText {
    async fn transcribe(&self, audio_path: &Path, language: Option<&str>) -> Result<String>;
    async fn transcribe_stream(&self, audio_path: &Path) -> Result<impl Stream<Item = String>>;
}

pub struct OpenAIWhisperClient {
    api_key: String,
    model: String,
    base_url: String,
}

impl SpeechToText for OpenAIWhisperClient {
    async fn transcribe(&self, audio_path: &Path, language: Option<&str>) -> Result<String> {
        // 使用 reqwest 上传音频文件到 OpenAI API
        // POST https://api.openai.com/v1/audio/transcriptions
    }
}

pub struct QwenASRClient {
    api_key: String,
    model: String,  // "qwen3-asr-flash"
}

impl SpeechToText for QwenASRClient {
    async fn transcribe(&self, audio_path: &Path, language: Option<&str>) -> Result<String> {
        // 调用 Alibaba DashScope API
    }

    async fn transcribe_stream(&self, audio_path: &Path) -> Result<impl Stream<Item = String>> {
        // 流式转录，逐字返回
    }
}
```

### 5.5 文本优化模块 (Text Refiner)

**职责**:
- 使用 GPT/Qwen 模型优化转录文本
- 注入自定义术语表
- 去除填充词和口吃
- 支持自定义提示词

**主要 API**:
```rust
pub struct TextRefiner {
    api_key: String,
    model: String,
    custom_prompt: Option<String>,
    glossary: Vec<String>,
}

impl TextRefiner {
    pub fn new(api_key: String, model: String) -> Self;

    // 优化文本
    pub async fn refine(&self, text: &str) -> Result<String>;

    // 设置自定义术语表
    pub fn set_glossary(&mut self, terms: Vec<String>);

    // 设置自定义提示词
    pub fn set_custom_prompt(&mut self, prompt: String);

    // 构建带术语表的提示词
    fn build_prompt(&self, text: &str) -> String {
        format!(
            "优化以下语音转录文本，去除填充词和口吃，保持原意。\n\
             术语表：{}\n\n原文：{}",
            self.glossary.join(", "),
            text
        )
    }
}
```

### 5.6 文本插入模块 (Text Inserter)

**职责**:
- 将文本插入到活动窗口
- 支持 Clipboard 和 SendKeys 两种方法
- 支持流式字符插入

**主要 API**:
```rust
pub struct TextInserter {
    method: InsertionMethod,
    delay_ms: u64,
    streaming: bool,
}

pub enum InsertionMethod {
    Clipboard,  // 使用剪贴板 + Ctrl+V
    SendKeys,   // 模拟键盘输入
}

impl TextInserter {
    pub fn new(method: InsertionMethod, delay_ms: u64, streaming: bool) -> Self;

    // 插入文本
    pub async fn insert_text(&self, text: &str) -> Result<()>;

    // 流式插入（逐字符）
    pub async fn insert_streaming(&self, text_stream: impl Stream<Item = String>) -> Result<()>;

    // Clipboard 方法实现
    async fn insert_via_clipboard(&self, text: &str) -> Result<()> {
        // 1. 保存当前剪贴板内容
        // 2. 将文本复制到剪贴板
        // 3. 模拟 Ctrl+V
        // 4. 恢复原剪贴板内容
    }

    // SendKeys 方法实现
    async fn insert_via_sendkeys(&self, text: &str) -> Result<()> {
        // 使用 enigo 逐字符模拟键盘输入
    }
}
```

### 5.7 配置管理模块 (Config Manager)

**职责**:
- 持久化应用配置
- API 密钥加密存储
- 历史记录管理

**主要 API**:
```rust
#[derive(Serialize, Deserialize, Clone)]
pub struct AppConfig {
    // API 设置
    pub openai_api_key: String,
    pub stt_model: String,
    pub refinement_model: String,

    // 音频设置
    pub sample_rate: u32,
    pub channels: u16,
    pub chunk_size: usize,

    // 快捷键设置
    pub hotkey: String,
    pub toggle_hotkey: String,

    // 功能开关
    pub enable_text_refinement: bool,
    pub enable_audio_processing: bool,
    pub enable_audio_feedback: bool,
    pub enable_streaming_output: bool,

    // 其他设置
    pub insertion_method: String,
    pub insertion_delay: f64,
    pub custom_glossary: Vec<String>,
    pub debug_mode: bool,
}

pub struct ConfigManager {
    config_path: PathBuf,
}

impl ConfigManager {
    pub fn load() -> Result<AppConfig>;
    pub fn save(&self, config: &AppConfig) -> Result<()>;
    pub fn encrypt_api_key(key: &str) -> Result<String>;
    pub fn decrypt_api_key(encrypted: &str) -> Result<String>;
}
```

### 5.8 Tauri Commands（前端调用的后端接口）

```rust
// 应用控制
#[tauri::command]
async fn start_app(config: AppConfig) -> Result<(), String>;

#[tauri::command]
async fn stop_app() -> Result<(), String>;

// 音频设备
#[tauri::command]
async fn list_audio_devices() -> Result<Vec<AudioDevice>, String>;

// 快捷键管理
#[tauri::command]
async fn register_hotkey(key: String, mode: String) -> Result<(), String>;

#[tauri::command]
async fn test_hotkey(key: String) -> Result<bool, String>;

// 配置管理
#[tauri::command]
async fn load_config() -> Result<AppConfig, String>;

#[tauri::command]
async fn save_config(config: AppConfig) -> Result<(), String>;

// API 测试
#[tauri::command]
async fn test_openai_api(api_key: String) -> Result<bool, String>;

#[tauri::command]
async fn test_qwen_api(api_key: String) -> Result<bool, String>;

// 术语表管理
#[tauri::command]
async fn add_glossary_term(term: String) -> Result<(), String>;

#[tauri::command]
async fn remove_glossary_term(term: String) -> Result<(), String>;

#[tauri::command]
async fn get_glossary() -> Result<Vec<String>, String>;

// 历史记录
#[tauri::command]
async fn get_history() -> Result<Vec<HistoryEntry>, String>;

#[tauri::command]
async fn clear_history() -> Result<(), String>;

// 手动触发操作
#[tauri::command]
async fn manual_start_recording() -> Result<(), String>;

#[tauri::command]
async fn manual_stop_recording() -> Result<String, String>;
```

## 6. 前端设计

### 6.1 组件结构

```
App
├── Layout
│   ├── Header（应用标题和状态指示器）
│   ├── WelcomeSection（欢迎信息和快速入门）
│   └── Footer（版本信息）
│
├── StatusPanel（状态面板）
│   ├── StatusIndicator（状态指示灯）
│   ├── ActiveSettingsDisplay（当前活动设置）
│   └── ControlButtons（启动/停止按钮）
│
├── TranscriptPanel（转录面板）
│   ├── TranscriptDisplay（转录结果显示）
│   ├── CopyButton（复制按钮）
│   └── ProcessingIndicator（处理进度指示器）
│
├── SettingsPanel（设置面板 - 可折叠）
│   ├── APISettings（API 设置）
│   │   ├── APIKeyInput（API 密钥输入）
│   │   ├── ModelSelector（模型选择）
│   │   └── TestButton（测试连接）
│   │
│   ├── AudioSettings（音频设置）
│   │   ├── DeviceSelector（设备选择）
│   │   ├── SampleRateSelector（采样率选择）
│   │   ├── ChannelSelector（声道选择）
│   │   └── ProcessingToggles（音频处理开关）
│   │
│   ├── HotkeySettings（快捷键设置）
│   │   ├── PushToTalkInput（按住说话快捷键）
│   │   ├── ToggleInput（切换录音快捷键）
│   │   └── HotkeyValidator（冲突检测）
│   │
│   ├── InsertionSettings（文本插入设置）
│   │   ├── MethodSelector（插入方法选择）
│   │   ├── DelayInput（延迟设置）
│   │   └── StreamingToggle（流式输出开关）
│   │
│   ├── GlossaryManager（术语表管理）
│   │   ├── TermList（术语列表）
│   │   ├── AddTermInput（添加术语）
│   │   ├── SearchBar（搜索框）
│   │   └── DeleteButton（删除按钮）
│   │
│   └── AdvancedSettings（高级设置）
│       ├── ThemeToggle（主题切换）
│       ├── LoggingToggle（日志开关）
│       ├── DebugModeToggle（调试模式）
│       └── AutostartToggle（开机自启动）
│
└── HistoryPanel（历史记录面板）
    ├── HistoryList（记录列表）
    ├── HistoryItem（单条记录）
    │   ├── Timestamp（时间戳）
    │   ├── OriginalText（原始文本）
    │   ├── RefinedText（优化后文本）
    │   └── CopyButton（复制按钮）
    └── ClearButton（清空历史）
```

### 6.2 状态管理（Zustand）

```typescript
// 应用状态
interface AppState {
  // 运行状态
  appStatus: 'stopped' | 'running' | 'recording' | 'processing';
  setAppStatus: (status: AppState['appStatus']) => void;

  // 当前转录结果
  currentTranscript: string;
  setCurrentTranscript: (text: string) => void;

  // 历史记录
  history: HistoryEntry[];
  addHistory: (entry: HistoryEntry) => void;
  clearHistory: () => void;

  // 设置
  config: AppConfig;
  updateConfig: (config: Partial<AppConfig>) => void;
  saveConfig: () => Promise<void>;
  loadConfig: () => Promise<void>;

  // 音频设备列表
  audioDevices: AudioDevice[];
  loadAudioDevices: () => Promise<void>;

  // 术语表
  glossary: string[];
  addGlossaryTerm: (term: string) => Promise<void>;
  removeGlossaryTerm: (term: string) => Promise<void>;

  // 错误状态
  error: string | null;
  setError: (error: string | null) => void;

  // 启动/停止应用
  startApp: () => Promise<void>;
  stopApp: () => Promise<void>;
}

// 历史记录条目
interface HistoryEntry {
  id: string;
  timestamp: Date;
  originalText: string;
  refinedText: string;
  duration: number; // 录音时长（秒）
}

// 应用配置（与 Rust 侧的 AppConfig 对应）
interface AppConfig {
  // API 设置
  openai_api_key: string;
  stt_model: 'whisper-1' | 'qwen3-asr-flash';
  refinement_model: string;

  // 音频设置
  sample_rate: 8000 | 16000 | 44100;
  channels: 1 | 2;
  chunk_size: 512 | 1024 | 2048;

  // 快捷键
  hotkey: string;
  toggle_hotkey: string;

  // 功能开关
  enable_text_refinement: boolean;
  enable_audio_processing: boolean;
  enable_audio_feedback: boolean;
  enable_streaming_output: boolean;
  remove_punctuation: boolean;

  // 插入设置
  insertion_method: 'clipboard' | 'sendkeys';
  insertion_delay: number;

  // 其他
  custom_glossary: string[];
  debug_mode: boolean;
  theme: 'light' | 'dark';
}
```

### 6.3 关键交互流程

#### 6.3.1 启动应用流程
```typescript
async function handleStartApp() {
  try {
    // 1. 验证配置
    if (!config.openai_api_key) {
      throw new Error('请先配置 API 密钥');
    }

    // 2. 保存配置到后端
    await invoke('save_config', { config });

    // 3. 启动应用
    await invoke('start_app', { config });

    // 4. 更新前端状态
    setAppStatus('running');

    // 5. 开始监听后端事件
    listenToBackendEvents();
  } catch (error) {
    setError(error.message);
  }
}
```

#### 6.3.2 监听后端事件
```typescript
function listenToBackendEvents() {
  // 监听录音开始事件
  listen('recording_started', () => {
    setAppStatus('recording');
  });

  // 监听录音停止事件
  listen('recording_stopped', () => {
    setAppStatus('processing');
  });

  // 监听转录结果（流式）
  listen('transcription_chunk', (event) => {
    const chunk = event.payload as string;
    setCurrentTranscript(prev => prev + chunk);
  });

  // 监听转录完成
  listen('transcription_complete', (event) => {
    const result = event.payload as { original: string; refined: string };

    // 添加到历史记录
    addHistory({
      id: Date.now().toString(),
      timestamp: new Date(),
      originalText: result.original,
      refinedText: result.refined,
      duration: 0,
    });

    // 恢复运行状态
    setAppStatus('running');
  });

  // 监听错误
  listen('error', (event) => {
    setError(event.payload as string);
    setAppStatus('running');
  });
}
```

### 6.4 UI 设计规范

#### 6.4.1 状态指示器样式
```css
/* 灰色 - 已停止 */
.status-stopped { background: #9CA3AF; }

/* 绿色 - 运行中 */
.status-running { background: #10B981; animation: pulse 2s infinite; }

/* 红色 - 录音中 */
.status-recording { background: #EF4444; animation: blink 1s infinite; }

/* 黄色 - 处理中 */
.status-processing { background: #F59E0B; animation: spin 2s infinite; }
```

#### 6.4.2 布局设计
- 使用 Tailwind CSS 的 flex 和 grid 布局
- 响应式设计，适配不同窗口大小
- 设置面板可折叠，节省空间
- 使用 shadcn/ui 的 Accordion、Tabs、Dialog 等组件

#### 6.4.3 主题支持
- 亮色主题：白色背景，黑色文字
- 暗色主题：深灰背景，浅色文字
- 使用 Tailwind 的 `dark:` 前缀实现主题切换

## 7. 开发计划

### Phase 1: 项目初始化（1周）
**目标**：搭建基础项目结构和开发环境

- [  ] 初始化 Tauri 项目（`npm create tauri-app`）
- [ ] 配置 React + TypeScript + Vite
- [ ] 集成 Tailwind CSS 和 shadcn/ui
- [ ] 设置 ESLint + Prettier
- [ ] 配置 Rust 工作区和基础依赖
- [ ] 搭建基础 UI 框架（Layout、Header、Footer）
- [ ] 实现基础的 Tauri IPC 通信测试

**交付物**：可运行的空白 Tauri 应用

### Phase 2: 核心后端功能（2-3周）
**目标**：实现 Rust 后端的核心模块

#### Week 1: 音频录制和处理
- [ ] 实现 AudioRecorder 模块（使用 cpal + hound）
- [ ] 实现设备枚举和选择功能
- [ ] 实现 WAV 文件保存
- [ ] 实现 AudioProcessor 模块
  - [ ] 静音检测和移除（使用 RMS 或 dBFS 计算）
  - [ ] 音高保持的时间拉伸（调研 Rust PSOLA 实现）
  - [ ] 立体声转单声道
- [ ] 编写单元测试

#### Week 2: 全局快捷键
- [ ] 实现 HotkeyService 模块（使用 rdev）
- [ ] 实现按住说话模式
- [ ] 实现切换录音模式
- [ ] 处理按键按下和释放事件
- [ ] 实现快捷键动态修改
- [ ] 测试快捷键冲突检测

#### Week 3: 云端 API 集成
- [ ] 实现 OpenAI Whisper API 客户端（使用 reqwest）
- [ ] 实现 Alibaba Qwen API 客户端
- [ ] 实现流式转录支持
- [ ] 实现 TextRefiner 模块（GPT 优化）
- [ ] 实现术语表注入功能
- [ ] 错误处理和重试机制
- [ ] API 测试功能

### Phase 3: 文本插入和配置（1周）
**目标**：完成文本插入和配置管理

- [ ] 实现 TextInserter 模块
  - [ ] Clipboard 方法（使用 arboard）
  - [ ] SendKeys 方法（使用 enigo）
  - [ ] 流式字符插入
- [ ] 实现 ConfigManager 模块
  - [ ] JSON 配置持久化
  - [ ] API 密钥加密存储
  - [ ] 历史记录管理
- [ ] 实现音频反馈（使用 rodio）
- [ ] 定义所有 Tauri Commands

### Phase 4: 前端开发（2周）
**目标**：完成前端 UI 和交互

#### Week 1: 基础 UI
- [ ] 实现状态管理（Zustand store）
- [ ] 实现 StatusPanel 组件
- [ ] 实现 TranscriptPanel 组件
- [ ] 实现基础的 SettingsPanel
- [ ] 实现主题切换功能

#### Week 2: 高级功能
- [ ] 完善所有设置项的 UI
- [ ] 实现 GlossaryManager 组件
- [ ] 实现 HistoryPanel 组件
- [ ] 实现错误提示和加载状态
- [ ] 实现快捷键验证和冲突检测 UI
- [ ] 响应式布局适配

### Phase 5: 集成联调（1周）
**目标**：前后端集成和端到端测试

- [ ] 连接前端和后端所有接口
- [ ] 实现事件监听和状态同步
- [ ] 测试完整的录音→转录→插入流程
- [ ] 测试两种录音模式
- [ ] 测试音频处理功能
- [ ] 测试文本优化功能
- [ ] 测试术语表功能
- [ ] 性能优化和内存泄漏检查

### Phase 6: 测试和优化（1-2周）
**目标**：完善功能和用户体验

- [ ] 功能测试
  - [ ] 不同快捷键组合测试
  - [ ] 长时间录音测试
  - [ ] 多种音频设备测试
  - [ ] 网络异常测试
- [ ] 性能优化
  - [ ] 减少按键响应延迟
  - [ ] 优化音频处理性能
  - [ ] 减少内存占用
- [ ] 用户体验优化
  - [ ] 添加快速入门指南
  - [ ] 完善错误提示信息
  - [ ] 添加操作反馈动画
  - [ ] 优化流式输出体验

### Phase 7: 打包和发布（1周）
**目标**：生成可分发的安装包

- [ ] 配置 Tauri 打包选项
  - [ ] 设置应用图标
  - [ ] 配置应用元数据（名称、版本等）
  - [ ] 配置权限和系统集成
- [ ] 生成 Windows 安装包（NSIS）
- [ ] 生成便携式版本
- [ ] 编写用户文档
  - [ ] README 安装说明
  - [ ] 使用教程
  - [ ] 常见问题解答
- [ ] 发布 v1.0.0 版本

**总计：7-9周**

## 8. 技术难点和解决方案

### 8.1 全局快捷键的按键释放检测
**难点**：Tauri 的 `global-shortcut` 插件只能检测按键按下，无法检测按键释放

**解决方案**：
- 使用 `rdev` 库进行底层键盘事件监听
- 在独立线程中运行 rdev 监听循环
- 维护按键状态机，跟踪按键的按下和释放
- 使用 Channel 与主线程通信

```rust
fn start_rdev_listener() {
    thread::spawn(|| {
        rdev::listen(|event| {
            match event.event_type {
                EventType::KeyPress(key) => {
                    // 检查是否为目标快捷键
                    if is_target_hotkey(key) {
                        send_event(HotkeyEvent::Pressed);
                    }
                }
                EventType::KeyRelease(key) => {
                    if is_target_hotkey(key) {
                        send_event(HotkeyEvent::Released);
                    }
                }
                _ => {}
            }
        });
    });
}
```

### 8.2 音高保持的音频加速（PSOLA）
**难点**：Rust 生态中没有现成的 PSOLA 实现库

**解决方案选项**：

**选项 1**：从头实现 PSOLA 算法（推荐）
- 基于论文实现基础的 PSOLA 算法
- 参考 Python 的 `psola` 库
- 时间成本：约 2-3 天

**选项 2**：调用 Python 脚本
- 使用 `std::process::Command` 调用 Python
- 传递音频文件路径，返回处理后的文件
- 需要用户安装 Python 和相关依赖

**选项 3**：使用 FFmpeg
- 使用 FFmpeg 的 `atempo` 滤镜（不保持音高）
- 或使用 `rubberband` 滤镜（保持音高，需要编译支持）
- 需要打包 FFmpeg 二进制文件

**推荐**：优先尝试选项 1，如果时间不够则使用选项 2 作为临时方案

### 8.3 云端 API 的流式输出
**难点**：需要支持 SSE（Server-Sent Events）或 WebSocket 流式接收

**解决方案**：
- 使用 `reqwest` 的 streaming body 功能
- 解析 SSE 格式的响应（`data: {...}\n\n`）
- 通过 Tauri 事件系统实时发送到前端

```rust
async fn transcribe_streaming(audio_path: &Path, app: AppHandle) -> Result<String> {
    let response = client
        .post("https://api.openai.com/v1/audio/transcriptions")
        .multipart(form)
        .send()
        .await?;

    let mut stream = response.bytes_stream();
    let mut full_text = String::new();

    while let Some(chunk) = stream.next().await {
        let text = parse_sse_chunk(chunk?)?;
        full_text.push_str(&text);

        // 发送到前端
        app.emit_all("transcription_chunk", &text)?;
    }

    Ok(full_text)
}
```

### 8.4 跨平台音频录制
**难点**：不同操作系统的音频 API 差异

**解决方案**：
- 使用 `cpal` 库，它已经抽象了跨平台差异
- Windows：使用 WASAPI
- macOS：使用 CoreAudio
- Linux：使用 ALSA 或 PulseAudio

**注意事项**：
- Windows 上需要请求麦克风权限
- 在 `tauri.conf.json` 中配置权限

### 8.5 文本插入的兼容性
**难点**：不同应用对文本插入的支持不同

**解决方案**：
- **Clipboard 方法**（推荐）：
  - 优点：速度快，兼容性好
  - 缺点：会覆盖剪贴板（需要临时保存并恢复）

- **SendKeys 方法**：
  - 优点：不影响剪贴板
  - 缺点：速度慢，某些特殊字符可能有问题

- 允许用户在设置中切换两种方法
- 对于特殊字符（表情、中文标点等），SendKeys 需要特殊处理

### 8.6 API 密钥的安全存储
**难点**：配置文件以明文存储 API 密钥存在安全风险

**解决方案**：
- 使用简单的 XOR 加密或 AES 加密
- 密钥存储在系统级别（Windows Credential Manager）
- 或使用 Tauri 的 `tauri-plugin-store` 插件的加密功能

```rust
use aes_gcm::{Aes256Gcm, Key, Nonce};
use aes_gcm::aead::{Aead, NewAead};

fn encrypt_api_key(key: &str) -> Result<String> {
    let cipher_key = Key::from_slice(b"your-32-byte-key-here-for-aes256");
    let cipher = Aes256Gcm::new(cipher_key);
    let nonce = Nonce::from_slice(b"unique nonce");

    let ciphertext = cipher.encrypt(nonce, key.as_bytes())
        .map_err(|e| anyhow!("Encryption failed: {}", e))?;

    Ok(base64::encode(ciphertext))
}
```

## 9. 配置文件设计

### 9.1 应用配置文件 (push_to_talk_config.json)

存储位置：
- Windows: `%APPDATA%\PushToTalk\push_to_talk_config.json`
- macOS: `~/Library/Application Support/PushToTalk/push_to_talk_config.json`
- Linux: `~/.config/PushToTalk/push_to_talk_config.json`

```json
{
  "version": "1.0.0",
  "openai_api_key": "sk-...",
  "stt_model": "whisper-1",
  "refinement_model": "gpt-3.5-turbo",
  "sample_rate": 16000,
  "channels": 1,
  "chunk_size": 1024,
  "hotkey": "ctrl+shift+space",
  "toggle_hotkey": "ctrl+shift+^",
  "insertion_method": "clipboard",
  "insertion_delay": 0.005,
  "enable_text_refinement": true,
  "enable_audio_processing": true,
  "enable_audio_feedback": true,
  "enable_streaming_output": true,
  "remove_punctuation": false,
  "debug_mode": false,
  "silence_threshold": -16.0,
  "min_silence_duration": 400.0,
  "speed_factor": 1.5,
  "custom_glossary": [
    "Tauri",
    "React",
    "TypeScript",
    "Rust"
  ],
  "theme": "dark",
  "enable_logging": true,
  "enable_autostart": false
}
```

### 9.2 配置参数说明

| 参数 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| `version` | string | `"1.0.0"` | 配置文件版本，用于迁移 |
| `openai_api_key` | string | `""` | OpenAI API 密钥（加密存储） |
| `stt_model` | string | `"whisper-1"` | STT 模型：`whisper-1` 或 `qwen3-asr-flash` |
| `refinement_model` | string | `"gpt-3.5-turbo"` | 文本优化模型 |
| `sample_rate` | number | `16000` | 音频采样率（Hz）：8000/16000/44100 |
| `channels` | number | `1` | 声道数：1（单声道）/ 2（立体声） |
| `chunk_size` | number | `1024` | 音频块大小（样本） |
| `hotkey` | string | `"ctrl+shift+space"` | 按住说话快捷键 |
| `toggle_hotkey` | string | `"ctrl+shift+^"` | 切换录音快捷键 |
| `insertion_method` | string | `"clipboard"` | 插入方法：`clipboard` / `sendkeys` |
| `insertion_delay` | number | `0.005` | 插入延迟（秒） |
| `enable_text_refinement` | boolean | `true` | 是否启用文本优化 |
| `enable_audio_processing` | boolean | `true` | 是否启用音频处理 |
| `enable_audio_feedback` | boolean | `true` | 是否启用音频反馈 |
| `enable_streaming_output` | boolean | `true` | 是否启用流式输出 |
| `remove_punctuation` | boolean | `false` | 是否移除标点符号 |
| `debug_mode` | boolean | `false` | 调试模式（保存处理后的音频） |
| `silence_threshold` | number | `-16.0` | 静音阈值（dBFS） |
| `min_silence_duration` | number | `400.0` | 最小静音持续时间（ms） |
| `speed_factor` | number | `1.5` | 音频加速倍数 |
| `custom_glossary` | array | `[]` | 自定义术语表 |
| `theme` | string | `"dark"` | 主题：`light` / `dark` |
| `enable_logging` | boolean | `true` | 是否启用日志 |
| `enable_autostart` | boolean | `false` | 是否开机自启动 |

## 10. 测试计划

### 10.1 单元测试

#### Rust 后端测试
```bash
# 运行所有测试
cargo test

# 运行特定模块测试
cargo test audio_recorder
cargo test hotkey_service
```

**测试覆盖**：
- AudioRecorder：设备枚举、录音开始/停止、WAV 文件生成
- AudioProcessor：静音检测、时间拉伸、格式转换
- HotkeyService：快捷键解析、按键事件处理
- CloudSTT：API 调用、错误处理、流式输出
- TextRefiner：文本优化、术语表注入
- ConfigManager：配置加载/保存、加密/解密

#### 前端测试
```bash
# 使用 Vitest 进行单元测试
npm run test

# 组件测试（使用 React Testing Library）
npm run test:ui
```

### 10.2 集成测试

**测试场景**：
1. **完整录音流程**：
   - 按下快捷键 → 录音 → 释放快捷键 → 转录 → 插入文本
   - 验证每个步骤的状态变化

2. **切换录音模式**：
   - 按一次开始录音 → 等待 → 再按一次停止
   - 验证状态切换正确

3. **音频处理**：
   - 录制包含静音段的音频
   - 验证静音被正确移除
   - 验证音频加速后音高不变

4. **API 错误处理**：
   - 模拟网络错误
   - 验证重试机制
   - 验证错误提示

5. **术语表功能**：
   - 添加术语表
   - 录制包含术语的音频
   - 验证术语被正确识别

### 10.3 手工测试

**测试矩阵**：

| 测试项 | 测试场景 | 预期结果 |
|--------|---------|---------|
| 快捷键 | 不同组合键（Ctrl+Space, F12等） | 全部正常响应 |
| 音频设备 | 切换不同麦克风 | 正常录音 |
| 长时间录音 | 录音 60 秒 | 不崩溃，正常转录 |
| 网络异常 | 断网情况下录音 | 显示错误提示 |
| 多次使用 | 连续录音 20 次 | 内存不泄漏 |
| 不同应用 | 在 Word、Chrome、VS Code 中插入 | 全部成功 |
| 中英文混合 | 录制中英文混合语音 | 正确识别 |
| 特殊字符 | 包含标点、数字、表情 | 正确插入 |

### 10.4 性能测试

**测试指标**：

| 指标 | 目标 | 测试方法 |
|------|------|---------|
| 按键响应 | < 50ms | 使用高速相机测量延迟 |
| 音频处理 | < 1s（3-4s音频） | 计时统计 |
| API 调用 | 根据网络，2-5s | 记录响应时间 |
| 内存占用 | < 100MB（运行时） | 任务管理器监控 |
| CPU 占用 | < 5%（待机时） | 任务管理器监控 |
| 打包大小 | < 30MB | 检查最终 exe 大小 |

## 11. 后续扩展功能（v2.0+）

- [ ] **多语言自动检测**：自动识别语音语言
- [ ] **实时字幕模式**：悬浮窗显示实时转录字幕
- [ ] **云端同步**：历史记录和设置云端备份
- [ ] **语音命令**：通过语音控制应用设置
- [ ] **批量处理**：导入音频文件批量转录
- [ ] **macOS 和 Linux 支持**：扩展到其他平台
- [ ] **插件系统**：支持第三方 STT 引擎
- [ ] **语音增强**：降噪、音量标准化
- [ ] **多用户支持**：多个配置 profile
- [ ] **统计分析**：使用时长、转录字数统计
- [ ] **自动更新**：应用自动更新机制

## 12. 参考资源

### 12.1 官方文档
- **Tauri**: https://tauri.app/
  - Tauri 2.x 文档：https://v2.tauri.app/
  - IPC 通信：https://v2.tauri.app/develop/inter-process-communication/
  - 打包指南：https://v2.tauri.app/distribute/

- **React**: https://react.dev/
  - React + TypeScript：https://react-typescript-cheatsheet.netlify.app/

- **Tailwind CSS**: https://tailwindcss.com/docs
  - shadcn/ui：https://ui.shadcn.com/

### 12.2 Rust Crates 文档
- **cpal**（音频 I/O）：https://docs.rs/cpal/
- **hound**（WAV 文件）：https://docs.rs/hound/
- **rdev**（全局按键）：https://docs.rs/rdev/
- **reqwest**（HTTP 客户端）：https://docs.rs/reqwest/
- **tokio**（异步运行时）：https://tokio.rs/
- **serde**（序列化）：https://serde.rs/
- **rodio**（音频播放）：https://docs.rs/rodio/
- **arboard**（剪贴板）：https://docs.rs/arboard/
- **enigo**（键盘模拟）：https://docs.rs/enigo/

### 12.3 API 文档
- **OpenAI Whisper API**: https://platform.openai.com/docs/api-reference/audio
- **Alibaba DashScope**: https://help.aliyun.com/zh/dashscope/developer-reference/quick-start
- **GPT API**: https://platform.openai.com/docs/api-reference/chat

### 12.4 原项目
- **PushToTalk Python 版本**: `G:\project\push-to-talk-main`
  - README: 查看原项目实现细节
  - src/: 参考各模块的实现逻辑
  - 特别关注：
    - `src/audio_processor.py`：音频处理实现
    - `src/hotkey_service.py`：快捷键实现
    - `src/transcription.py`：API 调用实现

### 12.5 技术文章
- **PSOLA 算法**：
  - TD-PSOLA 论文：https://www.ee.columbia.edu/~dpwe/papers/MouliE91-tdpsola.pdf
  - Python psola 库：https://github.com/spencermg/psola

- **Tauri + React 教程**：
  - https://tauri.app/v1/guides/getting-started/setup/vite

- **全局快捷键实现**：
  - https://github.com/obv-mikhail/InputBot（Rust 示例）

### 12.6 类似项目
- **Talon Voice**: https://talonvoice.com/（语音控制软件）
- **Voice Control for VS Code**: https://marketplace.visualstudio.com/items?itemName=pokey.voice
- **Desktop Dictation Tools**: 各种桌面听写工具参考

### 12.7 工具和库
- **音频处理工具**：
  - FFmpeg：https://ffmpeg.org/
  - Audacity：用于测试音频处理效果

- **API 测试工具**：
  - Postman：测试 API 接口
  - curl：命令行 API 测试

### 12.8 开发工具
- **Rust 工具链**：
  - rustup：Rust 版本管理
  - cargo：Rust 包管理器

- **Node.js 工具**：
  - pnpm/npm：包管理器
  - Vite：前端构建工具

- **IDE 推荐**：
  - VS Code + Rust Analyzer 插件
  - Cursor（AI 辅助开发）

---

## 附录 A：关键依赖版本

### Rust 依赖 (Cargo.toml)
```toml
[dependencies]
tauri = "2.0"
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
tokio = { version = "1", features = ["full"] }
reqwest = { version = "0.11", features = ["json", "multipart", "stream"] }
cpal = "0.15"
hound = "3.5"
rdev = "0.5"
rodio = "0.17"
arboard = "3.3"
enigo = "0.1"
thiserror = "1.0"
anyhow = "1.0"
tracing = "0.1"
tracing-subscriber = "0.3"
base64 = "0.21"
aes-gcm = "0.10"
```

### 前端依赖 (package.json)
```json
{
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "@tauri-apps/api": "^2.0.0",
    "zustand": "^4.4.0",
    "zod": "^3.22.0",
    "react-hook-form": "^7.48.0",
    "lucide-react": "^0.294.0"
  },
  "devDependencies": {
    "@vitejs/plugin-react": "^4.2.0",
    "vite": "^5.0.0",
    "typescript": "^5.3.0",
    "tailwindcss": "^3.3.0",
    "autoprefixer": "^10.4.16",
    "postcss": "^8.4.32",
    "vitest": "^1.0.0",
    "@testing-library/react": "^14.1.0"
  }
}
```

## 附录 B：项目目录结构

```
push-to-talk/
├── src-tauri/           # Rust 后端
│   ├── src/
│   │   ├── main.rs                  # 主入口
│   │   ├── lib.rs                   # 库入口
│   │   ├── commands.rs              # Tauri Commands
│   │   ├── audio_recorder.rs        # 音频录制模块
│   │   ├── audio_processor.rs       # 音频处理模块
│   │   ├── hotkey_service.rs        # 快捷键模块
│   │   ├── cloud_stt.rs             # 云端 STT 客户端
│   │   ├── text_refiner.rs          # 文本优化模块
│   │   ├── text_inserter.rs         # 文本插入模块
│   │   ├── config_manager.rs        # 配置管理模块
│   │   ├── audio_feedback.rs        # 音频反馈模块
│   │   └── utils.rs                 # 工具函数
│   ├── Cargo.toml
│   ├── tauri.conf.json  # Tauri 配置文件
│   └── icons/           # 应用图标
│
├── src/                 # React 前端
│   ├── components/
│   │   ├── Layout/
│   │   │   ├── Header.tsx
│   │   │   ├── Footer.tsx
│   │   │   └── WelcomeSection.tsx
│   │   ├── StatusPanel/
│   │   │   ├── StatusIndicator.tsx
│   │   │   ├── ActiveSettings.tsx
│   │   │   └── ControlButtons.tsx
│   │   ├── TranscriptPanel/
│   │   │   ├── TranscriptDisplay.tsx
│   │   │   └── CopyButton.tsx
│   │   ├── SettingsPanel/
│   │   │   ├── APISettings.tsx
│   │   │   ├── AudioSettings.tsx
│   │   │   ├── HotkeySettings.tsx
│   │   │   ├── InsertionSettings.tsx
│   │   │   ├── GlossaryManager.tsx
│   │   │   └── AdvancedSettings.tsx
│   │   └── HistoryPanel/
│   │       ├── HistoryList.tsx
│   │       └── HistoryItem.tsx
│   ├── store/
│   │   └── appStore.ts  # Zustand 状态管理
│   ├── lib/
│   │   ├── tauri.ts     # Tauri API 封装
│   │   └── utils.ts     # 工具函数
│   ├── types/
│   │   └── index.ts     # TypeScript 类型定义
│   ├── App.tsx          # 主应用组件
│   ├── main.tsx         # React 入口
│   └── index.css        # 全局样式
│
├── public/              # 静态资源
├── tests/               # 测试文件
│   ├── rust/            # Rust 单元测试
│   └── frontend/        # 前端测试
├── docs/                # 文档
│   ├── 需求文档.md
│   ├── 用户手册.md
│   └── 开发指南.md
├── .gitignore
├── package.json
├── tsconfig.json
├── tailwind.config.js
├── vite.config.ts
└── README.md
```

---

**文档版本**: v2.0 (完整版)
**创建日期**: 2025-10-29
**最后更新**: 2025-10-29
**作者**: Claude
**基于**: Python 版本 PushToTalk (G:\project\push-to-talk-main)